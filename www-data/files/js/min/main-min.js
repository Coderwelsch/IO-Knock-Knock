function init(){initVariables(),bindEvents(),main()}function initVariables(){webSocket=new WebSocket(wsUrl),$overlay=$("#overlay"),$body=$(".body"),$authDeviceView=$body.find(".split-table-view.view-left"),$searchedDeviceView=$body.find(".split-table-view.view-right"),$searchedDeviceTable=$searchedDeviceView.find("table.device-table"),$searchedDeviceTableBody=$searchedDeviceTable.find("tbody"),$searchedLastSyncTime=$searchedDeviceView.find("span.sync-time"),$authDeviceTable=$authDeviceView.find("table.device-table"),$searchedDeviceTable=$searchedDeviceView.find("table.device-table"),$authDeviceTableBody=$authDeviceTable.find("tbody"),$authLastSyncTime=$authDeviceView.find("span.sync-time")}function bindEvents(){webSocket.onmessage=receivedMessageFromServer,$authDeviceTableBody.on("click","span.action.remove",removeItemClicked),$searchedDeviceTableBody.on("click","span.action.add",addItemClicked)}function main(){startDataRequesting()}function removeItemClicked(e){var a=$(this),t=a.closest("tr"),n=parseInt(t.attr("data-index"));stopDataRequesting(),addOverlay("remove",authDeviceData[n])}function addItemClicked(e){var a=$(this),t=a.closest("tr"),n=parseInt(t.attr("data-index"));stopDataRequesting(),addOverlay("add",searchedDeviceData[n])}function addOverlay(e,a){var t={remove:{headline:"Remove Device !?",action:"remove",target:"authentificated"},add:{headline:"Add Device !?",action:"add",target:"authentificated"}};$overlay.addClass("show"),$body.addClass("blurry"),$overlay.find(".headline").text(t[e].headline),$overlay.find(".action").text(t[e].action),$overlay.find(".name").text(a.name),$overlay.find(".address").text(a.address),$overlay.find(".target-list").text(t[e].target),$overlay.one("click",".close, .button.cancel",overlayCloseClicked),$overlay.one("click",".button.accept",function(){applyData(e,a)})}function applyData(e,a){$.ajax({type:"POST",url:"http://knock-knock-pi.local/setJsonData",data:a,success:function(e){console.log(e)},dataType:"text"})}function overlayCloseClicked(){$overlay.removeClass("show"),$body.removeClass("blurry"),startDataRequesting()}function stopDataRequesting(){clearInterval(authInterval),clearInterval(searchedInterval)}function startDataRequesting(){getAuthJsonData(),getSearchedJsonData()}function getAuthJsonData(){authInterval=setInterval(function(){$.getJSON(getAuthJsonUrl,updateAuthDevices)},4e3)}function getSearchedJsonData(e){searchedInterval=setInterval(function(){$.getJSON(getSearchJsonUrl,updateSearchedDevices)},4e3)}function updateTableData(e,a,t,n){var i=new Date;a.empty(),t.text(getFormattedTimeString(i));for(var c=0;c<e.length;c++){var s=e[c],d=new Date(s.time),r=$("<tr></tr>").attr("data-index",c),o=$("<td></td>"),l=o.clone().addClass("name").text(s.name),v=o.clone().addClass("address").text(s.address),u=o.clone().addClass("status"),h=o.clone().addClass("time"),D=o.clone().addClass("actions");u.text("0"===s.status?"Not Available":"1"===s.status?"Available":"Unknown: "+s.status);var p=$("<span></span>").addClass("action").addClass(n["class"]).text(n.label);D.append(p),h.text(getFormattedTimeString(d)),r.append(l).append(v).append(u).append(h).append(D),a.append(r)}}function getFormattedTimeString(e){var a=e.getHours()<10?"0"+e.getHours():e.getHours(),t=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),n=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return a+":"+t+":"+n}function updateSearchedDevices(e){searchedDeviceData=e,updateTableData(searchedDeviceData,$searchedDeviceTableBody,$searchedLastSyncTime,searchedActions)}function updateAuthDevices(e){authDeviceData=e,updateTableData(authDeviceData,$authDeviceTableBody,$authLastSyncTime,authActions)}function receivedMessageFromServer(e){var a=JSON.parse(e.data);switch(a.type){case"auth-devices":updateAuthDevices(a);break;case"searched-devices":}}function error(e){console.error(e)}var requiredScripts=["jquery/jquery-2.1.4.min"],webSocket,wsUrl="ws://knock-knock-pi.local:8081",getAuthJsonUrl="http://knock-knock-pi.local:8080/getJsonData=auth-dev",getSearchJsonUrl="http://knock-knock-pi.local:8080/getJsonData=searched-dev",authDeviceData={},searchedDeviceData={},authLastSyncTime=Date.now(),authInterval=0,searchedInterval=0,searchedActions={label:"Add","class":"add"},authActions={label:"Remove","class":"remove"},$overlay,$body,$authDeviceView,$searchedDeviceView,$searchedLastSyncTime,$authDeviceTable,$searchedDeviceTable,$authDeviceTableBody,$authLastSyncTime;require(requiredScripts,init,error);