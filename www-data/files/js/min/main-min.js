function init(){initVariables(),bindEvents(),main()}function initVariables(){webSocket=new WebSocket(wsUrl),$overlayDeviceManager=$("#overlay-device-manager"),$overlayLogin=$("#login-form"),$body=$(".body"),$loginBtn=$body.find(".login-button"),$authDeviceView=$body.find(".split-table-view.view-left"),$searchedDeviceView=$body.find(".split-table-view.view-right"),$searchedDeviceTable=$searchedDeviceView.find("table.device-table"),$searchedDeviceTableBody=$searchedDeviceTable.find("tbody"),$searchedLastSyncTime=$searchedDeviceView.find("span.sync-time"),$authDeviceTable=$authDeviceView.find("table.device-table"),$searchedDeviceTable=$searchedDeviceView.find("table.device-table"),$authDeviceTableBody=$authDeviceTable.find("tbody"),$authLastSyncTime=$authDeviceView.find("span.sync-time")}function bindEvents(){webSocket.onmessage=receivedMessageFromServer,$authDeviceTableBody.on("click","span.action.remove",removeItemClicked),$searchedDeviceTableBody.on("click","span.action.add",addItemClicked),$loginBtn.hasClass("log-in")?$loginBtn.on("click",loginBtnClicked):$loginBtn.on("click",logOut)}function logOut(){window.location.href="index.php?logout=true"}function loginBtnClicked(e){$overlayLogin.addClass("show"),$body.addClass("blurry"),$overlayLogin.find("input").focus(),$overlayLogin.one("click",".close",function(){$body.removeClass("blurry"),$overlayLogin.removeClass("show")})}function main(){startDataRequesting()}function removeItemClicked(e){var a=$(this),t=a.closest("tr"),i=parseInt(t.attr("data-index"));stopDataRequesting(),addOverlay("remove",authDeviceData[i])}function addItemClicked(e){var a=$(this),t=a.closest("tr"),i=parseInt(t.attr("data-index"));stopDataRequesting(),addOverlay("add",searchedDeviceData[i])}function addOverlay(e,a){var t={remove:{headline:"Remove Device !?",action:"remove",target:"authentificated"},add:{headline:"Add Device !?",action:"add",target:"authentificated"}};$overlayDeviceManager.addClass("show"),$body.addClass("blurry"),$overlayDeviceManager.find(".headline").text(t[e].headline),$overlayDeviceManager.find(".action").text(t[e].action),$overlayDeviceManager.find(".name").text(a.name),$overlayDeviceManager.find(".address").text(a.address),$overlayDeviceManager.find(".target-list").text(t[e].target),$overlayDeviceManager.one("click",".close, .button.cancel",overlayCloseClicked),$overlayDeviceManager.one("click",".button.accept",function(){applyData(e,a)})}function applyData(e,a){a.type=e,$.ajax({type:"POST",url:removeJsonUrl,data:a,success:function(e){e.success?overlayCloseClicked():console.log("ERROR: ",e.error)},dataType:"json"})}function overlayCloseClicked(){$overlayDeviceManager.removeClass("show"),$body.removeClass("blurry"),startDataRequesting()}function stopDataRequesting(){clearInterval(authInterval),clearInterval(searchedInterval)}function startDataRequesting(){getAuthJsonData(),getSearchedJsonData()}function getAuthJsonData(){authInterval=setInterval(function(){$.getJSON(getAuthJsonUrl,updateAuthDevices)},4e3)}function getSearchedJsonData(e){searchedInterval=setInterval(function(){$.getJSON(getSearchJsonUrl,updateSearchedDevices)},4e3)}function updateTableData(e,a,t,i){var n=new Date;a.empty(),t.text(getFormattedTimeString(n));for(var c=0;c<e.length;c++){var s=e[c],o=new Date(s.time),r=$("<tr></tr>").attr("data-index",c),d=$("<td></td>"),l=d.clone().addClass("name").text(s.name),v=d.clone().addClass("address").text(s.address),u=d.clone().addClass("status"),h=d.clone().addClass("time"),D=d.clone().addClass("actions");u.text("0"===s.status?"Not Available":"1"===s.status?"Available":"Unknown: "+s.status);var g=$("<span></span>").addClass("action").addClass(i["class"]).text(i.label);D.append(g),h.text(getFormattedTimeString(o)),r.append(l).append(v).append(u).append(h).append(D),a.append(r)}}function getFormattedTimeString(e){var a=e.getHours()<10?"0"+e.getHours():e.getHours(),t=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),i=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return a+":"+t+":"+i}function updateSearchedDevices(e){searchedDeviceData=e,updateTableData(searchedDeviceData,$searchedDeviceTableBody,$searchedLastSyncTime,searchedActions)}function updateAuthDevices(e){authDeviceData=e,updateTableData(authDeviceData,$authDeviceTableBody,$authLastSyncTime,authActions)}function receivedMessageFromServer(e){var a=JSON.parse(e.data);switch(a.type){case"auth-devices":updateAuthDevices(a);break;case"searched-devices":}}function error(e){console.error(e)}var requiredScripts=["jquery/jquery-2.1.4.min"],webSocket,wsUrl="ws://knock-knock-pi.local:8081",getAuthJsonUrl="files/php/get-available-device-data.php",getSearchJsonUrl="files/php/get-searched-device-data.php",removeJsonUrl="files/php/remove-auth-device-data.php",authDeviceData={},searchedDeviceData={},authLastSyncTime=Date.now(),authInterval=0,searchedInterval=0,searchedActions={label:"Add","class":"add"},authActions={label:"Remove","class":"remove"},$overlayDeviceManager,$overlayLogin,$body,$loginBtn,$authDeviceView,$searchedDeviceView,$searchedLastSyncTime,$authDeviceTable,$searchedDeviceTable,$authDeviceTableBody,$authLastSyncTime;require(requiredScripts,init,error);